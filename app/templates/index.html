<!doctype html>
<html lang="{{ get_locale() }}">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />

<title>{{ _('LLOT — Local LLM Ollama Translator') }}</title>
<!-- Favicon for all browsers -->
<link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}" />
<link rel="icon" type="image/svg+xml" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.svg') }}" />
<link rel="icon" type="image/svg+xml" sizes="96x96" href="{{ url_for('static', filename='favicon-96x96.svg') }}" />

<!-- Apple Touch Icon -->
<link rel="apple-touch-icon" href="{{ url_for('static', filename='apple-touch-icon.svg') }}" />

<!-- Web App Manifest -->
<link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}" />
<meta name="theme-color" content="#2563eb" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="apple-mobile-web-app-title" content="llot" />
<meta name="format-detection" content="telephone=no" />

<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

</head>
<body>
<div class="container">
  <header>
    <div class="card logo-container" style="padding:12px 16px;">
      <img src="{{ url_for('static', filename='images/llot-logo.svg') }}" alt="LLOT Logo" width="36" height="36">
      <div>
        <div class="brand-text">LLOT</div>
        <div class="small brand-subtitle">{{ _('— local llm ollama translator') }}</div>
      </div>
    </div>
    <div style="flex:1"></div>
    {% if config.DEBUG %}
    <div class="language-selector">
      <select onchange="changeLanguage(this.value)">
        {% for code, name in languages %}
          <option value="{{ code }}" {% if get_locale() == code %}selected{% endif %}>{{ name }}</option>
        {% endfor %}
      </select>
    </div>
    {% endif %}
    <div class="small">{{ _('Ollama') }}: <code>{{ ollama_host }}</code> • {{ _('Model') }}: <code>{{ model }}</code></div>
  </header>

  <div class="card workspace">
    <div class="topbar">
      <div class="left-group">
        <div>
          <label class="small">{{ _('Source') }}</label><br/>
          <div class="select-wrap">
            <select id="source_lang" name="source_lang">
              {% for code,name in languages %}
                <option value="{{code}}" {% if code=='auto' %}selected{% endif %}>{{name}}{% if code!='auto' %} ({{code}}){% endif %}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <div class="swap-col" style="display:flex; align-items:flex-end;">
          <button id="swap_top" type="button" class="btn-icon" title="{{ _('Swap direction') }}" aria-label="{{ _('Swap direction') }}">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M7 7h13M17 3l3 4-3 4M17 17H4M7 13l-3 4 3 4" stroke="#334155" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>

        <div>
          <label class="small">{{ _('Target') }}</label><br/>
          <div class="select-wrap">
            <select id="target_lang" name="target_lang">
              {% for code,name in languages %}
                {% if code!='auto' %}
                  <option value="{{code}}" {% if code=='de' %}selected{% endif %}>{{name}} ({{code}})</option>
                {% endif %}
              {% endfor %}
            </select>
          </div>
        </div>

        <div>
          <label class="small">{{ _('Tone') }}</label><br/>
          <div class="select-wrap">
            <select id="tone" name="tone">
              {% for val,label in tones %}
                <option value="{{val}}" {% if val=='neutral' %}selected{% endif %}>{{label}}</option>
              {% endfor %}
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- History below dropdowns -->
    <div class="history-block">
      <div class="small">{{ _('Recent translations history:') }}</div>
      <div class="history" id="history">
        <!-- History will be loaded from localStorage by JavaScript -->
      </div>
    </div>

    <div class="row" style="margin-top:12px;">
      <div class="col">
        <label class="small">{{ _('Text to translate') }}</label>
        <textarea name="source_text" id="source_text" placeholder="{{ _('Paste or type text...') }}">{{ last_input|default('') }}</textarea>
        <div class="controls">
          <div class="small" id="translation_hint">{{ _('Translation starts automatically') }}<span id="detected_badge" class="badge" style="display:none;"></span></div>
          <div id="status" class="status" aria-live="polite"><div class="spinner"></div><span id="status_text">{{ _('Translating...') }}</span></div>
          <div style="flex:1"></div>
        </div>
      </div>
      <div class="col">
        <label class="small">{{ _('Result') }}</label>
        <div class="result-container">
          <div class="result-box" id="result">{{ translated|default('') }}</div>
          {% if tts_enabled %}
          <button id="tts-btn" class="tts-button" title="{{ _('Listen to pronunciation') }}" style="display: none;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M11 5L6 9H2v6h4l5 4V5zM19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          {% endif %}
        </div>
      </div>
    </div>

    {% if error %}
      <div style="margin-top:10px;color:#b91c1c;"><strong>{{ _('Error:') }}</strong> {{ error }}</div>
    {% endif %}
  </div>
</div>

<script src="{{ url_for('static', filename='js/app.js') }}"></script>
<script>
// Initialize with template data
window.initialTranslated = {{ translated|tojson|safe if translated is defined else '""' }};

// Language switching function
function changeLanguage(lang) {
  window.location.href = '/set_language/' + lang;
}
</script>
</body>
</html>