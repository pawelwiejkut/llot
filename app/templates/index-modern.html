<!doctype html>
<html lang="{{ get_locale() }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>{{ _('LLOT — Local LLM Ollama Translator') }}</title>
  <meta name="description" content="{{ _('Privacy-first translation service powered by local LLM. No API keys, no cloud services, 100% self-hosted.') }}">
  
  <!-- Favicon for all browsers -->
  <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">
  <link rel="icon" type="image/svg+xml" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.svg') }}">
  <link rel="icon" type="image/svg+xml" sizes="96x96" href="{{ url_for('static', filename='favicon-96x96.svg') }}">
  
  <!-- Apple Touch Icon -->
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='apple-touch-icon.svg') }}">
  
  <!-- Web App Manifest -->
  <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}">
  
  <!-- Theme -->
  <meta name="theme-color" content="#3b82f6" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#60a5fa" media="(prefers-color-scheme: dark)">
  
  <!-- Styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style-modern.css') }}?v={{ range(1000, 9999) | random }}">
</head>
<body>
  <div class="app-container">
    <div class="main-container">
      <!-- Header -->
      <header class="header">
        <a href="/" class="brand" aria-label="{{ _('LLOT Home') }}">
          <div class="brand-logo">
            <img src="{{ url_for('static', filename='images/llot-logo.svg') }}" alt="LLOT Logo" width="20" height="20">
          </div>
          <div class="brand-text">
            <h1 class="brand-title">LLOT</h1>
            <p class="brand-subtitle">{{ _('Local LLM Translator') }}</p>
          </div>
        </a>
        
        <div class="header-info">
          <div class="status-indicator" id="connection-status" title="{{ _('Click to check connection') }}">
            <span class="status-dot" id="status-dot"></span>
            <span class="status-text">{{ _('Connected') }}</span>
            <div class="status-details">
              <div>{{ _('Ollama') }}: {{ ollama_host }}</div>
              <div>{{ _('Model') }}: {{ model }}</div>
              {% if tts_enabled %}
              <div>{{ _('TTS') }}: {{ tts_host }}:{{ tts_port }}</div>
              {% else %}
              <div>{{ _('TTS') }}: {{ _('Disabled') }}</div>
              {% endif %}
            </div>
          </div>
          
          

          <button class="theme-toggle" id="theme-toggle" aria-label="{{ _('Toggle theme') }}">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="5"/>
              <line x1="12" y1="1" x2="12" y2="3"/>
              <line x1="12" y1="21" x2="12" y2="23"/>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
              <line x1="1" y1="12" x2="3" y2="12"/>
              <line x1="21" y1="12" x2="23" y2="12"/>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
            </svg>
          </button>
        </div>
      </header>
      

      <!-- Main workspace -->
      <main class="workspace">
        <!-- Control bar (hidden) -->
        <div class="control-bar">
          <div class="language-controls">
            <div class="language-select">
              <select id="source_lang_old" name="source_lang_old" aria-label="{{ _('Source language') }}">
                <option value="auto" selected>{{ _('Detect language') }}</option>
                <option value="en">English</option>
                <option value="de">Deutsch</option>
                <option value="es">Español</option>
                <option value="fr">Français</option>
                <option value="it">Italiano</option>
                <option value="pt">Português</option>
                <option value="ru">Русский</option>
                <option value="pl">Polski</option>
                <option value="nl">Nederlands</option>
                <option value="ja">日本語</option>
                <option value="ko">한국어</option>
                <option value="zh">中文</option>
                <option value="ar">العربية</option>
                <option value="hi">हिन्दी</option>
              </select>
            </div>
            
            <div class="language-select">
              <select id="target_lang_old" name="target_lang_old" aria-label="{{ _('Target language') }}">
                <option value="en">English</option>
                <option value="de" selected>Deutsch</option>
                <option value="es">Español</option>
                <option value="fr">Français</option>
                <option value="it">Italiano</option>
                <option value="pt">Português</option>
                <option value="ru">Русский</option>
                <option value="pl">Polski</option>
                <option value="nl">Nederlands</option>
                <option value="ja">日本語</option>
                <option value="ko">한국어</option>
                <option value="zh">中文</option>
                <option value="ar">العربية</option>
                <option value="hi">हिन्দी</option>
              </select>
            </div>
          </div>
          
          <div class="language-select">
            <select id="tone" name="tone" aria-label="{{ _('Translation tone') }}">
              {% for val, label in tones %}
                <option value="{{ val }}" {% if val=='neutral' %}selected{% endif %}>
                  {{ label }}
                </option>
              {% endfor %}
            </select>
          </div>
        </div>
        
        <!-- Language controls bar like DeepL -->
        <div class="language-controls-bar">
          <div class="language-dropdown" id="source-lang-dropdown-top">
            <button class="language-dropdown-trigger" type="button" aria-label="{{ _('Source language') }}">
              <span class="selected-language">{{ _('Detect language') }}</span>
            </button>
            <div class="language-dropdown-panel">
              <div class="language-dropdown-search">
                <input type="text" placeholder="{{ _('Search languages...') }}" />
              </div>
              <div class="language-dropdown-content" id="source-lang-options-top">
                <!-- Languages will be populated by JavaScript -->
              </div>
            </div>
          </div>

          <!-- Swap button in language bar -->
          <button class="swap-button-top" id="swap_languages_top" type="button" 
                  title="{{ _('Swap languages') }}" aria-label="{{ _('Swap languages') }}">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M7 7h13M17 3l3 4-3 4M17 17H4M7 13l-3 4 3 4"/>
            </svg>
          </button>

          <div class="language-dropdown" id="target-lang-dropdown-top">
            <button class="language-dropdown-trigger" type="button" aria-label="{{ _('Target language') }}">
              <span class="selected-language">Deutsch</span>
            </button>
            <div class="language-dropdown-panel">
              <div class="language-dropdown-search">
                <input type="text" placeholder="{{ _('Search languages...') }}" />
              </div>
              <div class="language-dropdown-content" id="target-lang-options-top">
                <!-- Languages will be populated by JavaScript -->
              </div>
            </div>
          </div>

          
        </div>
        
        <!-- Panel headers with swap button -->
        <div class="panels-header">
          <!-- Input panel header -->
          <div class="panel-header">
              <div class="language-dropdown" id="source-lang-dropdown">
                <button class="language-dropdown-trigger" type="button" aria-label="{{ _('Source language') }}">
                  <span class="selected-language">{{ _('Detect language') }}</span>
                </button>
                <div class="language-dropdown-panel">
                  <div class="language-dropdown-search">
                    <input type="text" placeholder="{{ _('Search languages...') }}" />
                  </div>
                  <div class="language-dropdown-content" id="source-lang-options">
                    <!-- Languages will be populated by JavaScript -->
                  </div>
                </div>
                <!-- Hidden select for form compatibility -->
                <select id="source_lang" name="source_lang" style="display: none;">
                  <option value="auto" selected>{{ _('Detect language') }}</option>
                  <option value="en">English</option>
                  <option value="de">Deutsch</option>
                  <option value="es">Español</option>
                  <option value="fr">Français</option>
                  <option value="it">Italiano</option>
                  <option value="pt">Português</option>
                  <option value="ru">Русский</option>
                  <option value="pl">Polski</option>
                  <option value="nl">Nederlands</option>
                  <option value="ja">日本語</option>
                  <option value="ko">한국어</option>
                  <option value="zh">中文</option>
                  <option value="ar">العربية</option>
                  <option value="hi">हিন্দী</option>
                </select>
              </div>
            </div>

          <!-- Swap button in header center -->
          <button class="swap-button-header" id="swap_languages" type="button" 
                  title="{{ _('Swap languages') }}" aria-label="{{ _('Swap languages') }}">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M7 7h13M17 3l3 4-3 4M17 17H4M7 13l-3 4 3 4"/>
            </svg>
          </button>

          <!-- Output panel header -->
          <div class="panel-header">
              <div class="language-dropdown" id="target-lang-dropdown">
                <button class="language-dropdown-trigger" type="button" aria-label="{{ _('Target language') }}">
                  <span class="selected-language">Deutsch</span>
                </button>
                <div class="language-dropdown-panel">
                  <div class="language-dropdown-search">
                    <input type="text" placeholder="{{ _('Search languages...') }}" />
                  </div>
                  <div class="language-dropdown-content" id="target-lang-options">
                    <!-- Languages will be populated by JavaScript -->
                  </div>
                </div>
                <!-- Hidden select for form compatibility -->
                <select id="target_lang" name="target_lang" style="display: none;">
                  <option value="en">English</option>
                  <option value="de" selected>Deutsch</option>
                  <option value="es">Español</option>
                  <option value="fr">Français</option>
                  <option value="it">Italiano</option>
                  <option value="pt">Português</option>
                  <option value="ru">Русский</option>
                  <option value="pl">Polski</option>
                  <option value="nl">Nederlands</option>
                  <option value="ja">日本語</option>
                  <option value="ko">한국어</option>
                  <option value="zh">中文</option>
                  <option value="ar">العربية</option>
                  <option value="hi">हিন্দী</option>
                </select>
              </div>
              
              <!-- Simple options menu -->
              <div class="options-menu" id="output-options-dropdown">
                <button class="options-trigger" type="button" aria-label="{{ _('Options') }}">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="1"/>
                    <circle cx="12" cy="5" r="1"/>
                    <circle cx="12" cy="19" r="1"/>
                  </svg>
                </button>
                <div class="options-panel">
                  <div class="option-item">
                    <label for="tone-output">{{ _('Tone') }}</label>
                    <select id="tone-output" name="tone" class="simple-select">
                      {% for val, label in tones %}
                        <option value="{{ val }}" {% if val=='neutral' %}selected{% endif %}>{{ label }}</option>
                      {% endfor %}
                    </select>
                  </div>
                  <div class="option-item">
                    <label for="model-select-output">{{ _('Model') }}</label>
                    <select id="model-select-output" name="model" class="simple-select">
                      <option value="{{ model }}" selected>{{ model }}</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
        </div>

        <!-- Translation interface -->
        <div class="translation-interface">
          <!-- Input panel -->
          <div class="input-panel">
            <textarea class="text-input" id="source_text" name="source_text"
                      placeholder="{{ _('Enter text to translate...') }}"
                      aria-label="{{ _('Text to translate') }}"
                      spellcheck="false">{{ last_input|default('') }}</textarea>
          </div>
          
          <!-- Output panel -->
          <div class="output-panel">
            <div class="text-output" id="result" aria-live="polite" aria-label="{{ _('Translation result') }}">
              {{ translated|default('') }}
              <!-- Action buttons container -->
              <div class="output-actions">
                <button id="copy-btn" class="action-button copy-button" title="{{ _('Copy to clipboard') }}" style="display: none;">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" stroke-width="2" fill="none"/>
                    <path d="m5 15-2-2v-4.586a1 1 0 0 1 .293-.707l5.414-5.414a1 1 0 0 1 .707-.293h4.586l2 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                  </svg>
                </button>
                {% if tts_enabled %}
                <button id="tts-btn" class="action-button tts-button" title="{{ _('Listen to pronunciation') }}" style="display: none;">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M11 5L6 9H2v6h4l5 4V5zM19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
        
        <!-- Status bar -->
        <div class="status-bar">
          <div class="translation-status" id="status" aria-live="polite">
            <div class="spinner" id="loading-spinner" style="display: none;"></div>
            <span id="status-text">{{ _('Ready to translate') }}</span>
          </div>
          <div class="char-count" id="char-count">0 {{ _('characters') }}</div>
        </div>
      </main>
      
      <!-- History panel -->
      <div class="history-panel" id="history-panel" style="display: none;">
        <div class="history-header">
          <h3 class="history-title">{{ _('Recent Translations') }}</h3>
        </div>
        <div class="history-list" id="history-list">
          <!-- History items will be loaded by JavaScript -->
        </div>
      </div>
      
      
      {% if error %}
      <div class="error-message" role="alert">
        <strong>{{ _('Error:') }}</strong> {{ error }}
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Scripts -->
  <script src="{{ url_for('static', filename='js/app-modern.js') }}?v={{ range(1000, 9999) | random }}"></script>
  <script>
    // Initialize with template data
    window.initialTranslated = {{ translated|tojson|safe if translated is defined else '""' }};
    window.ttsEnabled = {{ 'true' if tts_enabled else 'false' }};
    
    // Language switching function
    function changeLanguage(lang) {
      window.location.href = '/set_language/' + lang;
    }
  </script>
</body>
</html>